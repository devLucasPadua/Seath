<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>SEATH - Sistema de Análise</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        .form-label .form-switch { margin-bottom: -0.3rem; }
        .actions a:not(:last-child) { margin-right: 0.5rem; }
        .side-panel-item { cursor: pointer; }
    </style>
</head>
<body class="bg-light">

<div class="container-fluid mt-4">
    <header class="text-center mb-4">
        <h1>SEATH</h1>
        <p class="lead">Sistema de Engenharia para Análise, Testagem e Hospedagem</p>
    </header>

    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div data-th-if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
                <span data-th-text="${success}"></span><button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <div data-th-if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <span data-th-text="${error}"></span><button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Coluna do Menu -->
        <div class="col-lg-2">
             <div class="card shadow-sm mb-5">
                <div class="card-header"><h4 class="my-1">Menu</h4></div>
                <div class="card-body">
                    <div class="list-group">
                        <a href="#" class="list-group-item list-group-item-action" data-hx-get="/view/cadastrar" data-hx-target="#main-content" data-hx-swap="innerHTML">Cadastrar Ficha</a>
                        <a href="#" class="list-group-item list-group-item-action" data-hx-get="/view/listar" data-hx-target="#main-content" data-hx-swap="innerHTML">Listar Fichas</a>
                        <a href="#" class="list-group-item list-group-item-action" data-hx-get="/view/importar" data-hx-target="#main-content" data-hx-swap="innerHTML">Importar Histórico</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Coluna de Conteúdo Dinâmico -->
        <div class="col-lg-10">
            <div id="main-content" data-hx-get="/view/cadastrar" data-hx-trigger="load" data-hx-swap="innerHTML">
                <div class="d-flex justify-content-center align-items-center h-100">
                    <div class="spinner-border" role="status"><span class="visually-hidden">Carregando...</span></div>
                </div>
            </div>
        </div>
    </div>
    
</div>

<div class="modal fade" id="modalAdicionarPregao" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form data-th-action="@{/pregoes/salvar}" data-th-object="${pregaoForm}" method="post">
                <div class="modal-header"><h5 class="modal-title">Adicionar Novo Pregão</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <div class="mb-3"><label class="form-label">Número do Pregão:</label><input type="text" class="form-control" data-th-field="*{nome}" required pattern="[0-9\/\.\-\*]+" autocomplete="off"></div>
                    <div class="mb-3"><label class="form-label">Nome/Descrição do Pregão:</label><input type="text" class="form-control" data-th-field="*{descricao}" required autocomplete="off"></div>
                    <div class="mb-3"><label class="form-label">Número do Processo:</label><input type="text" class="form-control" data-th-field="*{processo}" required pattern="[0-9\/\.\-\*]+" autocomplete="off"></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button type="submit" class="btn btn-primary">Salvar</button></div>
            </form>
        </div>
    </div>
</div>
<!-- <div class="modal fade" id="modalAdicionarEmpresa" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form data-th-action="@{/empresas/salvar}" data-th-object="${empresaForm}" method="post">
                <div class="modal-header"><h5 class="modal-title">Adicionar Nova Empresa</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <div class="mb-3"><label class="form-label">Nome da Empresa:</label><input type="text" class="form-control" data-th-field="*{nome}" required autocomplete="off"></div>
                    <div class="mb-3"><label class="form-label">CNPJ:</label><input type="text" class="form-control" data-th-field="*{cnpj}" autocomplete="off"></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button type="submit" class="btn btn-primary">Salvar</button></div>
            </form>
        </div>
    </div>
</div> -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/htmx.org@1.9.10"></script>
<script>
    function isPregaoGroupLocked() { const groupSwitch = document.getElementById('lockPregaoGroup'); return groupSwitch && groupSwitch.checked; }
    function preencherFormularioPregao(numero, processo, descricao) { if (!isPregaoGroupLocked()) { document.getElementById('pregao').value = numero || ''; document.getElementById('processo').value = processo || ''; document.getElementById('nomePregao').value = descricao || ''; } }
    function preencherLicitante(nome) { if (!isLocked('licitante')) { document.getElementById('licitante').value = nome || ''; } }
    function isLocked(elementId) { if (!elementId) return false; const switchEl = document.querySelector(`.lock-switch[data-lock-target="${elementId}"]`); return switchEl && switchEl.checked; }
    const form = document.getElementById('fichaForm');
    form.addEventListener('submit', function() { const lockedFields = {}; if (isPregaoGroupLocked()) { lockedFields.lockPregaoGroup = true; lockedFields.pregao = document.getElementById('pregao').value; lockedFields.nomePregao = document.getElementById('nomePregao').value; lockedFields.processo = document.getElementById('processo').value; } document.querySelectorAll('.lock-switch:checked').forEach(switchEl => { const targetId = switchEl.dataset.lockTarget; const element = document.getElementById(targetId); if (element) { lockedFields[targetId] = element.value; } }); sessionStorage.setItem('lockedFields', JSON.stringify(lockedFields)); });
    document.addEventListener('DOMContentLoaded', function () { const lockedFieldsJSON = sessionStorage.getItem('lockedFields'); if (lockedFieldsJSON) { const lockedFields = JSON.parse(lockedFieldsJSON); if (lockedFields.lockPregaoGroup) { document.getElementById('lockPregaoGroup').checked = true; document.getElementById('pregao').value = lockedFields.pregao || ''; document.getElementById('nomePregao').value = lockedFields.nomePregao || ''; document.getElementById('processo').value = lockedFields.processo || ''; } document.querySelectorAll('.lock-switch').forEach(switchEl => { const targetId = switchEl.dataset.lockTarget; if (lockedFields[targetId]) { document.getElementById(targetId).value = lockedFields[targetId]; switchEl.checked = true; } }); } });
    document.addEventListener('keydown', function(event) { if (event.key !== 'Enter' && event.key !== 'Tab') { return; } const activeElement = document.activeElement; if (activeElement.id === 'saveButton' || activeElement.tagName.toLowerCase() === 'textarea') { return; } if (event.key === 'Enter') event.preventDefault(); const focusableElements = Array.from(form.querySelectorAll('input:not([readonly]):not(.lock-switch), select, textarea, button')); const currentIndex = focusableElements.indexOf(activeElement); if (event.key === 'Tab' && !event.shiftKey && currentIndex === focusableElements.length - 1) return; event.preventDefault(); let nextIndex = currentIndex; const direction = event.shiftKey ? -1 : 1; do { nextIndex = (nextIndex + direction + focusableElements.length) % focusableElements.length; if (nextIndex === currentIndex) { break; } } while (isLocked(focusableElements[nextIndex].id)); const nextElement = focusableElements[nextIndex]; if (nextElement) { nextElement.focus(); } });
    document.getElementById('searchPregao').addEventListener('input', function(event) { const searchTerm = event.target.value.toLowerCase(); const items = document.querySelectorAll('#pregao-list-container .side-panel-item'); items.forEach(item => { const itemText = item.textContent.toLowerCase(); item.style.display = itemText.includes(searchTerm) ? '' : 'none'; }); });
    document.getElementById('searchEmpresa').addEventListener('input', function(event) { const searchTerm = event.target.value.toLowerCase(); const items = document.querySelectorAll('#empresa-list-container .side-panel-item'); items.forEach(item => { const itemText = item.textContent.toLowerCase(); item.style.display = itemText.includes(searchTerm) ? '' : 'none'; }); });
</script>

</body>
</html>